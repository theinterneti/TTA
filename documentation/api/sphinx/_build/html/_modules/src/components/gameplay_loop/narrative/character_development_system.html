

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src.components.gameplay_loop.narrative.character_development_system &mdash; TTA - Therapeutic Text Adventure 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=c5250a58" />


      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../_static/copybutton.js?v=30646c52"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">mermaid.initialize({startOnLoad:true});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >



          <a href="../../../../../index.html" class="icon icon-home">
            TTA - Therapeutic Text Adventure
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../overview.html">Platform Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../api/modules.html">src</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../development/index.html">Development Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../testing/index.html">Testing Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../deployment/index.html">Deployment Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contributing.html">Contributing to TTA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">TTA - Therapeutic Text Adventure</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">src.components.gameplay_loop.narrative.character_development_system</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for src.components.gameplay_loop.narrative.character_development_system</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Character Development System for Core Gameplay Loop</span>

<span class="sd">This module provides character growth, attribute tracking, milestone detection,</span>
<span class="sd">and progression visualization for enhanced user engagement and therapeutic progress representation.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.components.gameplay_loop.models.core</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChoiceType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.components.gameplay_loop.services.session_state</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionState</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.events</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventBus</span><span class="p">,</span> <span class="n">EventType</span><span class="p">,</span> <span class="n">NarrativeEvent</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="CharacterAttribute">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterAttribute">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterAttribute</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core character attributes that can develop over time.&quot;&quot;&quot;</span>

    <span class="n">COURAGE</span> <span class="o">=</span> <span class="s2">&quot;courage&quot;</span>
    <span class="n">WISDOM</span> <span class="o">=</span> <span class="s2">&quot;wisdom&quot;</span>
    <span class="n">COMPASSION</span> <span class="o">=</span> <span class="s2">&quot;compassion&quot;</span>
    <span class="n">RESILIENCE</span> <span class="o">=</span> <span class="s2">&quot;resilience&quot;</span>
    <span class="n">COMMUNICATION</span> <span class="o">=</span> <span class="s2">&quot;communication&quot;</span>
    <span class="n">EMOTIONAL_INTELLIGENCE</span> <span class="o">=</span> <span class="s2">&quot;emotional_intelligence&quot;</span>
    <span class="n">PROBLEM_SOLVING</span> <span class="o">=</span> <span class="s2">&quot;problem_solving&quot;</span>
    <span class="n">SELF_AWARENESS</span> <span class="o">=</span> <span class="s2">&quot;self_awareness&quot;</span>
    <span class="n">LEADERSHIP</span> <span class="o">=</span> <span class="s2">&quot;leadership&quot;</span>
    <span class="n">CREATIVITY</span> <span class="o">=</span> <span class="s2">&quot;creativity&quot;</span>
    <span class="n">PATIENCE</span> <span class="o">=</span> <span class="s2">&quot;patience&quot;</span>
    <span class="n">DETERMINATION</span> <span class="o">=</span> <span class="s2">&quot;determination&quot;</span></div>



<div class="viewcode-block" id="CharacterMilestone">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterMilestone">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterMilestone</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Types of character development milestones.&quot;&quot;&quot;</span>

    <span class="n">FIRST_BRAVE_ACT</span> <span class="o">=</span> <span class="s2">&quot;first_brave_act&quot;</span>
    <span class="n">WISE_DECISION_MAKER</span> <span class="o">=</span> <span class="s2">&quot;wise_decision_maker&quot;</span>
    <span class="n">COMPASSIONATE_HELPER</span> <span class="o">=</span> <span class="s2">&quot;compassionate_helper&quot;</span>
    <span class="n">RESILIENT_SURVIVOR</span> <span class="o">=</span> <span class="s2">&quot;resilient_survivor&quot;</span>
    <span class="n">SKILLED_COMMUNICATOR</span> <span class="o">=</span> <span class="s2">&quot;skilled_communicator&quot;</span>
    <span class="n">EMOTIONALLY_AWARE</span> <span class="o">=</span> <span class="s2">&quot;emotionally_aware&quot;</span>
    <span class="n">CREATIVE_PROBLEM_SOLVER</span> <span class="o">=</span> <span class="s2">&quot;creative_problem_solver&quot;</span>
    <span class="n">SELF_REFLECTIVE_INDIVIDUAL</span> <span class="o">=</span> <span class="s2">&quot;self_reflective_individual&quot;</span>
    <span class="n">INSPIRING_LEADER</span> <span class="o">=</span> <span class="s2">&quot;inspiring_leader&quot;</span>
    <span class="n">PATIENT_GUIDE</span> <span class="o">=</span> <span class="s2">&quot;patient_guide&quot;</span>
    <span class="n">DETERMINED_ACHIEVER</span> <span class="o">=</span> <span class="s2">&quot;determined_achiever&quot;</span>
    <span class="n">MASTER_OF_SKILLS</span> <span class="o">=</span> <span class="s2">&quot;master_of_skills&quot;</span></div>



<div class="viewcode-block" id="DevelopmentTrigger">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.DevelopmentTrigger">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DevelopmentTrigger</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triggers for character development.&quot;&quot;&quot;</span>

    <span class="n">CHOICE_CONSEQUENCE</span> <span class="o">=</span> <span class="s2">&quot;choice_consequence&quot;</span>
    <span class="n">THERAPEUTIC_PROGRESS</span> <span class="o">=</span> <span class="s2">&quot;therapeutic_progress&quot;</span>
    <span class="n">SKILL_DEMONSTRATION</span> <span class="o">=</span> <span class="s2">&quot;skill_demonstration&quot;</span>
    <span class="n">MILESTONE_ACHIEVEMENT</span> <span class="o">=</span> <span class="s2">&quot;milestone_achievement&quot;</span>
    <span class="n">STORY_EVENT</span> <span class="o">=</span> <span class="s2">&quot;story_event&quot;</span>
    <span class="n">REPEATED_BEHAVIOR</span> <span class="o">=</span> <span class="s2">&quot;repeated_behavior&quot;</span>
    <span class="n">CHALLENGE_OVERCOME</span> <span class="o">=</span> <span class="s2">&quot;challenge_overcome&quot;</span>
    <span class="n">LEARNING_MOMENT</span> <span class="o">=</span> <span class="s2">&quot;learning_moment&quot;</span></div>



<div class="viewcode-block" id="AbilityType">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.AbilityType">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AbilityType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Types of abilities characters can unlock.&quot;&quot;&quot;</span>

    <span class="n">THERAPEUTIC_SKILL</span> <span class="o">=</span> <span class="s2">&quot;therapeutic_skill&quot;</span>
    <span class="n">SOCIAL_ABILITY</span> <span class="o">=</span> <span class="s2">&quot;social_ability&quot;</span>
    <span class="n">PROBLEM_SOLVING_TECHNIQUE</span> <span class="o">=</span> <span class="s2">&quot;problem_solving_technique&quot;</span>
    <span class="n">EMOTIONAL_REGULATION_TOOL</span> <span class="o">=</span> <span class="s2">&quot;emotional_regulation_tool&quot;</span>
    <span class="n">COMMUNICATION_STYLE</span> <span class="o">=</span> <span class="s2">&quot;communication_style&quot;</span>
    <span class="n">LEADERSHIP_APPROACH</span> <span class="o">=</span> <span class="s2">&quot;leadership_approach&quot;</span>
    <span class="n">CREATIVE_METHOD</span> <span class="o">=</span> <span class="s2">&quot;creative_method&quot;</span>
    <span class="n">COPING_STRATEGY</span> <span class="o">=</span> <span class="s2">&quot;coping_strategy&quot;</span></div>



<div class="viewcode-block" id="CharacterAttributeLevel">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterAttributeLevel">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterAttributeLevel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the level and progress of a character attribute.&quot;&quot;&quot;</span>

    <span class="n">attribute</span><span class="p">:</span> <span class="n">CharacterAttribute</span> <span class="o">=</span> <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span>
    <span class="n">current_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># 0.0-10.0 scale</span>
    <span class="n">experience_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">level_progress</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Progress toward next level (0.0-1.0)</span>

    <span class="c1"># Development tracking</span>
    <span class="n">last_increased</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">development_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Average increase per session</span>
    <span class="n">peak_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Highest level achieved</span>

    <span class="c1"># Story integration</span>
    <span class="n">story_manifestations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">character_reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Metadata</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">last_updated</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span></div>



<div class="viewcode-block" id="CharacterAbility">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterAbility">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterAbility</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an ability or skill the character has unlocked.&quot;&quot;&quot;</span>

    <span class="n">ability_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ability_type</span><span class="p">:</span> <span class="n">AbilityType</span> <span class="o">=</span> <span class="n">AbilityType</span><span class="o">.</span><span class="n">THERAPEUTIC_SKILL</span>

    <span class="c1"># Requirements and unlocking</span>
    <span class="n">required_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">unlock_trigger</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span> <span class="o">=</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">MILESTONE_ACHIEVEMENT</span>
    <span class="n">unlock_condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Usage and effectiveness</span>
    <span class="n">usage_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">effectiveness_rating</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># 0.0-1.0</span>
    <span class="n">last_used</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Story integration</span>
    <span class="n">unlock_story</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">usage_examples</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">character_dialogue</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Metadata</span>
    <span class="n">unlocked_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="CharacterMilestoneAchievement">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterMilestoneAchievement">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterMilestoneAchievement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Records achievement of a character development milestone.&quot;&quot;&quot;</span>

    <span class="n">achievement_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Milestone details</span>
    <span class="n">milestone</span><span class="p">:</span> <span class="n">CharacterMilestone</span> <span class="o">=</span> <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">FIRST_BRAVE_ACT</span>
    <span class="n">trigger</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span> <span class="o">=</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHOICE_CONSEQUENCE</span>

    <span class="c1"># Achievement context</span>
    <span class="n">triggering_choice</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">story_context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">attribute_levels_at_achievement</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span>
    <span class="p">)</span>

    <span class="c1"># Recognition and celebration</span>
    <span class="n">celebration_story</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">character_recognition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">new_abilities_unlocked</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Impact</span>
    <span class="n">attribute_bonuses</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">story_unlocks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Metadata</span>
    <span class="n">achieved_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">celebration_shown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="CharacterDevelopmentEvent">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentEvent">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterDevelopmentEvent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Records a character development event.&quot;&quot;&quot;</span>

    <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Event details</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span> <span class="o">=</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHOICE_CONSEQUENCE</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Attribute changes</span>
    <span class="n">attribute_changes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">experience_gained</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># Story integration</span>
    <span class="n">story_context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">character_feedback</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">narrative_impact</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Metadata</span>
    <span class="n">occurred_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">processed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="CharacterDevelopmentSystem">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CharacterDevelopmentSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main system for character development, growth tracking, and milestone management.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_bus</span><span class="p">:</span> <span class="n">EventBus</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span> <span class="o">=</span> <span class="n">event_bus</span>

        <span class="c1"># Character development tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="n">CharacterAttributeLevel</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">CharacterAbility</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">CharacterMilestoneAchievement</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">CharacterDevelopmentEvent</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Development configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_attribute_templates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ability_templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_ability_templates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">milestone_templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_milestone_templates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">development_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_development_rules</span><span class="p">()</span>

        <span class="c1"># Progression parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="mi">25</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mi">175</span><span class="p">,</span>
            <span class="mi">275</span><span class="p">,</span>
            <span class="mi">400</span><span class="p">,</span>
            <span class="mi">550</span><span class="p">,</span>
            <span class="mi">750</span><span class="p">,</span>
            <span class="mi">1000</span><span class="p">,</span>
        <span class="p">]</span>  <span class="c1"># XP needed for each level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">milestone_thresholds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_milestone_thresholds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ability_unlock_conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_ability_unlock_conditions</span><span class="p">()</span>

        <span class="c1"># Metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;attribute_increases&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;abilities_unlocked&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;milestones_achieved&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;development_events_processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;character_celebrations&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_attribute_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load character attribute templates and descriptions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Courage&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to face fears and take brave actions despite uncertainty&quot;</span><span class="p">,</span>
                <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Standing up for what&#39;s right even when it&#39;s difficult&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Facing challenging situations with determination&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Taking risks for personal growth and helping others&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;development_indicators&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Making difficult but necessary choices&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Confronting fears and anxieties&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Taking initiative in challenging situations&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Wisdom&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to make sound judgments and learn from experience&quot;</span><span class="p">,</span>
                <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Offering thoughtful advice to other characters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Learning from mistakes and applying lessons&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Seeing the bigger picture in complex situations&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;development_indicators&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Reflecting on experiences and extracting insights&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Making decisions based on long-term consequences&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Helping others learn from their experiences&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Compassion&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to understand and care for others&#39; wellbeing&quot;</span><span class="p">,</span>
                <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Showing kindness and empathy to struggling characters&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Putting others&#39; needs before personal gain&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Creating inclusive and supportive environments&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;development_indicators&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Choosing to help others even at personal cost&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Showing understanding for different perspectives&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Creating positive outcomes for multiple characters&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">RESILIENCE</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Resilience&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to bounce back from setbacks and adapt to challenges&quot;</span><span class="p">,</span>
                <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Recovering quickly from failures and disappointments&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Adapting strategies when initial approaches don&#39;t work&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Maintaining hope and determination through difficulties&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;development_indicators&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Persisting through multiple failed attempts&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Finding alternative solutions when blocked&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Maintaining positive attitude during setbacks&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Communication&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to express ideas clearly and listen effectively&quot;</span><span class="p">,</span>
                <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Resolving conflicts through effective dialogue&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Inspiring others with clear and compelling messages&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Building bridges between different groups or perspectives&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;development_indicators&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Successfully negotiating difficult conversations&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Helping others understand complex ideas&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Facilitating cooperation between conflicting parties&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Emotional Intelligence&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to understand and manage emotions effectively&quot;</span><span class="p">,</span>
                <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Recognizing and responding appropriately to others&#39; emotions&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Managing personal emotional reactions in challenging situations&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Creating emotionally supportive environments for others&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;development_indicators&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;Choosing emotional regulation over reactive responses&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Helping others process difficult emotions&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Maintaining emotional balance during stress&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_ability_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">AbilityType</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load ability templates for different ability types.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">AbilityType</span><span class="o">.</span><span class="n">THERAPEUTIC_SKILL</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Mindful Breathing&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to use breathing techniques to manage stress and anxiety&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">:</span> <span class="mf">3.0</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;unlock_story&quot;</span><span class="p">:</span> <span class="s2">&quot;Through practice and patience, you&#39;ve learned to harness the power of breath to find calm in any storm.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;usage_examples&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Using deep breathing before difficult conversations&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Teaching breathing techniques to anxious characters&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cognitive Reframing&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to challenge and reframe negative thought patterns&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">SELF_AWARENESS</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;unlock_story&quot;</span><span class="p">:</span> <span class="s2">&quot;Your growing wisdom allows you to see situations from multiple perspectives and help others do the same.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;usage_examples&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Helping characters see challenges as opportunities&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Reframing setbacks as learning experiences&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">AbilityType</span><span class="o">.</span><span class="n">SOCIAL_ABILITY</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Empathetic Listening&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to truly hear and understand others&#39; perspectives&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;unlock_story&quot;</span><span class="p">:</span> <span class="s2">&quot;Your compassionate heart and growing communication skills allow you to truly connect with others.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;usage_examples&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Providing comfort to distressed characters&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Mediating conflicts through understanding&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Inspiring Leadership&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The ability to motivate and guide others toward positive outcomes&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">LEADERSHIP</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                        <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;unlock_story&quot;</span><span class="p">:</span> <span class="s2">&quot;Your courage and natural leadership abilities inspire others to believe in themselves and take positive action.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;usage_examples&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Rallying characters to work together&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Inspiring hope in difficult situations&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">},</span>
            <span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_milestone_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterMilestone</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load milestone templates and celebration stories.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">FIRST_BRAVE_ACT</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;First Brave Act&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Taking your first truly courageous action despite fear&quot;</span><span class="p">,</span>
                <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">},</span>
                <span class="s2">&quot;celebration_story&quot;</span><span class="p">:</span> <span class="s2">&quot;The other characters notice a new strength in your bearing. Your first act of true courage has not gone unnoticed, and you feel a newfound confidence growing within you.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;attribute_bonuses&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">SELF_AWARENESS</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;story_unlocks&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;courage_based_story_paths&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;leadership_opportunities&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">WISE_DECISION_MAKER</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Wise Decision Maker&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Consistently making thoughtful, well-considered decisions&quot;</span><span class="p">,</span>
                <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
                <span class="s2">&quot;celebration_story&quot;</span><span class="p">:</span> <span class="s2">&quot;Your reputation for wise counsel spreads among the characters. They begin seeking your advice, recognizing the depth of your insight and judgment.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;attribute_bonuses&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">LEADERSHIP</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;story_unlocks&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;advisor_role_opportunities&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;complex_decision_scenarios&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">COMPASSIONATE_HELPER</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Compassionate Helper&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Consistently showing kindness and support to others&quot;</span><span class="p">,</span>
                <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
                <span class="s2">&quot;celebration_story&quot;</span><span class="p">:</span> <span class="s2">&quot;Your kindness has touched many hearts. Characters speak of your compassion with gratitude, and you&#39;ve become known as someone who truly cares.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;attribute_bonuses&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;story_unlocks&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;healing_role_opportunities&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;community_building_scenarios&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_development_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load rules for character development progression.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;attribute_gain_rates&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;choice_consequence&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Base attribute gain from choice consequences</span>
                <span class="s2">&quot;therapeutic_progress&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Gain from therapeutic milestone achievement</span>
                <span class="s2">&quot;skill_demonstration&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>  <span class="c1"># Gain from successfully using skills</span>
                <span class="s2">&quot;repeated_behavior&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># Smaller gain for repeated positive behaviors</span>
                <span class="s2">&quot;challenge_overcome&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>  <span class="c1"># Larger gain for overcoming significant challenges</span>
            <span class="p">},</span>
            <span class="s2">&quot;experience_multipliers&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;first_time&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># Double XP for first time doing something</span>
                <span class="s2">&quot;milestone_related&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>  <span class="c1"># 50% bonus for milestone-related actions</span>
                <span class="s2">&quot;therapeutic_aligned&quot;</span><span class="p">:</span> <span class="mf">1.3</span><span class="p">,</span>  <span class="c1"># 30% bonus for therapeutically aligned actions</span>
                <span class="s2">&quot;story_significant&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>  <span class="c1"># 20% bonus for story-significant actions</span>
            <span class="p">},</span>
            <span class="s2">&quot;regression_rules&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;max_regression&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># Maximum attribute loss from negative events</span>
                <span class="s2">&quot;recovery_multiplier&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>  <span class="c1"># Faster recovery after regression</span>
                <span class="s2">&quot;story_explanation&quot;</span><span class="p">:</span> <span class="s2">&quot;temporary setback that strengthens character through overcoming&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_milestone_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterMilestone</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load thresholds and conditions for milestone achievement.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">FIRST_BRAVE_ACT</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;min_courage&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="s2">&quot;required_actions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;face_fear&quot;</span><span class="p">,</span> <span class="s2">&quot;take_risk&quot;</span><span class="p">,</span> <span class="s2">&quot;stand_up_for_others&quot;</span><span class="p">],</span>
                <span class="s2">&quot;story_contexts&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;conflict_resolution&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;personal_challenge&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;helping_others&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">WISE_DECISION_MAKER</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;min_wisdom&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                <span class="s2">&quot;required_actions&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;thoughtful_choice&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;learn_from_mistake&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;give_advice&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;consecutive_wise_decisions&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">COMPASSIONATE_HELPER</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;min_compassion&quot;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                <span class="s2">&quot;required_actions&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;help_others&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;show_empathy&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;sacrifice_for_others&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">&quot;helping_actions_count&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_ability_unlock_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load conditions for unlocking specific abilities.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;mindful_breathing&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
                <span class="s2">&quot;required_milestones&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;story_conditions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;experienced_stress&quot;</span><span class="p">,</span> <span class="s2">&quot;learned_coping&quot;</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">&quot;cognitive_reframing&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">SELF_AWARENESS</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;required_milestones&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">WISE_DECISION_MAKER</span><span class="p">],</span>
                <span class="s2">&quot;story_conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;challenged_negative_thoughts&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;helped_others_reframe&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">&quot;empathetic_listening&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;required_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;required_milestones&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">COMPASSIONATE_HELPER</span><span class="p">],</span>
                <span class="s2">&quot;story_conditions&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;listened_to_others&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;provided_emotional_support&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
        <span class="p">}</span>

<div class="viewcode-block" id="CharacterDevelopmentSystem.process_character_development">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem.process_character_development">[docs]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_character_development</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process character development based on user actions and story events.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">session_state</span><span class="o">.</span><span class="n">user_id</span>

            <span class="c1"># Create development event</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">trigger</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Character development triggered by </span><span class="si">{</span><span class="n">trigger</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="n">story_context</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;story_context&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Initialize character attributes if needed</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_character_attributes</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Calculate attribute changes based on trigger and context</span>
            <span class="n">attribute_changes</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_attribute_changes</span><span class="p">(</span>
                <span class="n">trigger</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">session_state</span>
            <span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span> <span class="o">=</span> <span class="n">attribute_changes</span>

            <span class="c1"># Apply attribute changes</span>
            <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">attribute_changes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_attribute_change</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">trigger</span><span class="p">)</span>

            <span class="c1"># Calculate experience gained</span>
            <span class="n">experience_gained</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_experience_gained</span><span class="p">(</span>
                <span class="n">trigger</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">attribute_changes</span>
            <span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">experience_gained</span> <span class="o">=</span> <span class="n">experience_gained</span>

            <span class="c1"># Apply experience points</span>
            <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">xp</span> <span class="ow">in</span> <span class="n">experience_gained</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_experience_points</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span>

            <span class="c1"># Generate character feedback</span>
            <span class="n">event</span><span class="o">.</span><span class="n">character_feedback</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_character_feedback</span><span class="p">(</span>
                <span class="n">attribute_changes</span><span class="p">,</span> <span class="n">context</span>
            <span class="p">)</span>

            <span class="c1"># Generate narrative impact</span>
            <span class="n">event</span><span class="o">.</span><span class="n">narrative_impact</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_narrative_impact</span><span class="p">(</span>
                <span class="n">attribute_changes</span><span class="p">,</span> <span class="n">context</span>
            <span class="p">)</span>

            <span class="c1"># Check for milestone achievements</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_milestone_achievements</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">session_state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

            <span class="c1"># Check for ability unlocks</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ability_unlocks</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">session_state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

            <span class="c1"># Store development event</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">processed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Update session context</span>
            <span class="n">session_state</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;recent_character_development&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">event_id</span><span class="p">,</span>
                <span class="s2">&quot;attribute_changes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">change</span> <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">attribute_changes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;character_feedback&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">character_feedback</span><span class="p">,</span>
                <span class="s2">&quot;narrative_impact&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">narrative_impact</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Publish development event</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_development_event</span><span class="p">(</span><span class="n">session_state</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;development_events_processed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="n">event</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to process character development for user </span><span class="si">{</span><span class="n">session_state</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Return minimal event</span>
            <span class="k">return</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">trigger</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Character development event: </span><span class="si">{</span><span class="n">trigger</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span></div>


    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_character_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize character attributes for a new user.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">CharacterAttribute</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">CharacterAttributeLevel</span><span class="p">(</span>
                <span class="n">attribute</span><span class="o">=</span><span class="n">attribute</span><span class="p">,</span>
                <span class="n">current_level</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Start at level 1</span>
                <span class="n">experience_points</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">level_progress</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_attribute_changes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate attribute changes based on trigger and context.&quot;&quot;&quot;</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get base gain rate for trigger type</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_rules</span><span class="p">[</span><span class="s2">&quot;attribute_gain_rates&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">trigger</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.1</span>
        <span class="p">)</span>

        <span class="c1"># Determine which attributes should be affected</span>
        <span class="k">if</span> <span class="n">trigger</span> <span class="o">==</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHOICE_CONSEQUENCE</span><span class="p">:</span>
            <span class="c1"># Analyze choice to determine relevant attributes</span>
            <span class="n">choice_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choice_type&quot;</span><span class="p">)</span>
            <span class="n">therapeutic_relevance</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;therapeutic_relevance&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">choice_type</span> <span class="o">==</span> <span class="n">ChoiceType</span><span class="o">.</span><span class="n">EMOTIONAL_REGULATION</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">RESILIENCE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">choice_type</span> <span class="o">==</span> <span class="n">ChoiceType</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">choice_type</span> <span class="o">==</span> <span class="n">ChoiceType</span><span class="o">.</span><span class="n">PROBLEM_SOLVING</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">PROBLEM_SOLVING</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">choice_type</span> <span class="o">==</span> <span class="n">ChoiceType</span><span class="o">.</span><span class="n">SELF_REFLECTION</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">SELF_AWARENESS</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">therapeutic_relevance</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Default attribute gains for other choice types</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.5</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">SELF_AWARENESS</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.3</span>

        <span class="k">elif</span> <span class="n">trigger</span> <span class="o">==</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">THERAPEUTIC_PROGRESS</span><span class="p">:</span>
            <span class="c1"># Therapeutic progress affects multiple attributes</span>
            <span class="n">therapeutic_concept</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;therapeutic_concept&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">progress_level</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;progress_level&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;anxiety&quot;</span> <span class="ow">in</span> <span class="n">therapeutic_concept</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">RESILIENCE</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;communication&quot;</span> <span class="ow">in</span> <span class="n">therapeutic_concept</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;emotional&quot;</span> <span class="ow">in</span> <span class="n">therapeutic_concept</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="p">)</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">SELF_AWARENESS</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># General therapeutic progress</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">RESILIENCE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">progress_level</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">trigger</span> <span class="o">==</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHALLENGE_OVERCOME</span><span class="p">:</span>
            <span class="c1"># Overcoming challenges builds resilience and courage</span>
            <span class="n">challenge_difficulty</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;challenge_difficulty&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">RESILIENCE</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">challenge_difficulty</span>
            <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">challenge_difficulty</span>
            <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">DETERMINATION</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">base_rate</span> <span class="o">*</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">challenge_difficulty</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">trigger</span> <span class="o">==</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">SKILL_DEMONSTRATION</span><span class="p">:</span>
            <span class="c1"># Skill demonstration affects related attributes</span>
            <span class="n">skill_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skill_type&quot;</span><span class="p">,</span> <span class="s2">&quot;general&quot;</span><span class="p">)</span>
            <span class="n">effectiveness</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;effectiveness&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">skill_type</span> <span class="o">==</span> <span class="s2">&quot;communication&quot;</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMMUNICATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">effectiveness</span>
            <span class="k">elif</span> <span class="n">skill_type</span> <span class="o">==</span> <span class="s2">&quot;emotional_regulation&quot;</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">EMOTIONAL_INTELLIGENCE</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_rate</span> <span class="o">*</span> <span class="n">effectiveness</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">skill_type</span> <span class="o">==</span> <span class="s2">&quot;problem_solving&quot;</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">PROBLEM_SOLVING</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">effectiveness</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_rate</span> <span class="o">*</span> <span class="n">effectiveness</span>

        <span class="c1"># Apply multipliers</span>
        <span class="n">multipliers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_rules</span><span class="p">[</span><span class="s2">&quot;experience_multipliers&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_time&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">*=</span> <span class="n">multipliers</span><span class="p">[</span><span class="s2">&quot;first_time&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;milestone_related&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">*=</span> <span class="n">multipliers</span><span class="p">[</span><span class="s2">&quot;milestone_related&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;therapeutic_aligned&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">*=</span> <span class="n">multipliers</span><span class="p">[</span><span class="s2">&quot;therapeutic_aligned&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">changes</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_apply_attribute_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">attribute</span><span class="p">:</span> <span class="n">CharacterAttribute</span><span class="p">,</span>
        <span class="n">change</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply attribute change to character.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_character_attributes</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

        <span class="n">attr_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>

        <span class="c1"># Apply change</span>
        <span class="n">old_level</span> <span class="o">=</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span>
        <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span> <span class="o">+</span> <span class="n">change</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Update peak level</span>
        <span class="n">attr_level</span><span class="o">.</span><span class="n">peak_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">attr_level</span><span class="o">.</span><span class="n">peak_level</span><span class="p">,</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span><span class="p">)</span>

        <span class="c1"># Update development rate</span>
        <span class="k">if</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">last_increased</span><span class="p">:</span>
            <span class="n">time_diff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">last_increased</span>
            <span class="k">if</span> <span class="n">time_diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">attr_level</span><span class="o">.</span><span class="n">development_rate</span> <span class="o">=</span> <span class="n">change</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">time_diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>
                <span class="p">)</span>  <span class="c1"># Per hour</span>

        <span class="n">attr_level</span><span class="o">.</span><span class="n">last_increased</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">attr_level</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

        <span class="c1"># Add story manifestation</span>
        <span class="k">if</span> <span class="n">change</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">manifestations</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;story_manifestations&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">manifestations</span><span class="p">:</span>
                <span class="n">attr_level</span><span class="o">.</span><span class="n">story_manifestations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">manifestations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">change</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;attribute_increases&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_experience_gained</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trigger</span><span class="p">:</span> <span class="n">DevelopmentTrigger</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">attribute_changes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate experience points gained for each attribute.&quot;&quot;&quot;</span>
        <span class="n">experience</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">base_xp</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Base XP per development event</span>

        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">attribute_changes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># XP proportional to attribute change</span>
            <span class="n">xp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_xp</span> <span class="o">*</span> <span class="n">change</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Scale up for meaningful XP values</span>

            <span class="c1"># Apply multipliers</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_time&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">xp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xp</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;milestone_related&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">xp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xp</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>

            <span class="n">experience</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span>  <span class="c1"># Minimum 1 XP</span>

        <span class="k">return</span> <span class="n">experience</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_apply_experience_points</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">CharacterAttribute</span><span class="p">,</span> <span class="n">xp</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply experience points and handle level ups.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_character_attributes</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

        <span class="n">attr_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">][</span><span class="n">attribute</span><span class="p">]</span>
        <span class="n">attr_level</span><span class="o">.</span><span class="n">experience_points</span> <span class="o">+=</span> <span class="n">xp</span>

        <span class="c1"># Check for level up</span>
        <span class="n">current_level_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_level_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">next_level_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span><span class="p">[</span><span class="n">current_level_index</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">experience_points</span> <span class="o">&gt;=</span> <span class="n">next_level_threshold</span><span class="p">:</span>
                <span class="c1"># Level up!</span>
                <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">current_level_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">attr_level</span><span class="o">.</span><span class="n">level_progress</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="c1"># Add character reaction for level up</span>
                <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">attr_name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">attr_level</span><span class="o">.</span><span class="n">character_reactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;You feel your </span><span class="si">{</span><span class="n">attr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2"> growing stronger through your experiences and choices.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Update progress toward next level</span>
                <span class="n">current_level_threshold</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span><span class="p">[</span><span class="n">current_level_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">current_level_index</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">attr_level</span><span class="o">.</span><span class="n">experience_points</span> <span class="o">-</span> <span class="n">current_level_threshold</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">next_level_threshold</span> <span class="o">-</span> <span class="n">current_level_threshold</span>
                <span class="p">)</span>
                <span class="n">attr_level</span><span class="o">.</span><span class="n">level_progress</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">progress</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_generate_character_feedback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attribute_changes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate character feedback for development event.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attribute_changes</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Your character reflects on the recent experience.&quot;</span>

        <span class="c1"># Find the attribute with the largest change</span>
        <span class="n">primary_attribute</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">attribute_changes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">attr</span><span class="p">:</span> <span class="n">attribute_changes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">primary_change</span> <span class="o">=</span> <span class="n">attribute_changes</span><span class="p">[</span><span class="n">primary_attribute</span><span class="p">]</span>

        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">primary_attribute</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">attr_name</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">primary_attribute</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">primary_change</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;You feel a significant growth in your </span><span class="si">{</span><span class="n">attr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">. This experience has strengthened an important part of who you are.&quot;</span>
        <span class="k">elif</span> <span class="n">primary_change</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">attr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2"> develops through this experience. You notice yourself becoming more capable.&quot;</span>
        <span class="k">elif</span> <span class="n">primary_change</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;You sense a subtle improvement in your </span><span class="si">{</span><span class="n">attr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">. Small steps forward are still progress.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;This experience contributes to your ongoing development in </span><span class="si">{</span><span class="n">attr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_generate_narrative_impact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attribute_changes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate narrative impact description for development event.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attribute_changes</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;The story continues to unfold around your character&#39;s journey.&quot;</span>

        <span class="c1"># Find the most significant attribute change</span>
        <span class="n">primary_attribute</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">attribute_changes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">attr</span><span class="p">:</span> <span class="n">attribute_changes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">primary_change</span> <span class="o">=</span> <span class="n">attribute_changes</span><span class="p">[</span><span class="n">primary_attribute</span><span class="p">]</span>

        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">primary_attribute</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">manifestations</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;story_manifestations&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="n">manifestations</span> <span class="ow">and</span> <span class="n">primary_change</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Other characters begin to notice your growing </span><span class="si">{</span><span class="n">primary_attribute</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">manifestations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Your character&#39;s development in </span><span class="si">{</span><span class="n">primary_attribute</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> subtly influences the story around you.&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_milestone_achievements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">event</span><span class="p">:</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for milestone achievements and create celebrations.&quot;&quot;&quot;</span>
        <span class="n">user_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Get existing milestone achievements</span>
        <span class="n">existing_milestones</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">:</span>
            <span class="n">existing_milestones</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">achievement</span><span class="o">.</span><span class="n">milestone</span>
                <span class="k">for</span> <span class="n">achievement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Check each milestone</span>
        <span class="k">for</span> <span class="n">milestone</span><span class="p">,</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">milestone</span> <span class="ow">in</span> <span class="n">existing_milestones</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Already achieved</span>

            <span class="c1"># Check if milestone requirements are met</span>
            <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_milestone_requirements</span><span class="p">(</span>
                <span class="n">milestone</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">user_attributes</span><span class="p">,</span> <span class="n">event</span>
            <span class="p">):</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_achieve_milestone</span><span class="p">(</span>
                    <span class="n">user_id</span><span class="p">,</span> <span class="n">session_state</span><span class="p">,</span> <span class="n">milestone</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">event</span>
                <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_milestone_requirements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">milestone</span><span class="p">:</span> <span class="n">CharacterMilestone</span><span class="p">,</span>
        <span class="n">template</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">user_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="n">CharacterAttributeLevel</span><span class="p">],</span>
        <span class="n">event</span><span class="p">:</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if milestone requirements are satisfied.&quot;&quot;&quot;</span>
        <span class="c1"># Check required attributes</span>
        <span class="n">required_attributes</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required_attributes&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">min_level</span> <span class="ow">in</span> <span class="n">required_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_attributes</span>
                <span class="ow">or</span> <span class="n">user_attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">current_level</span> <span class="o">&lt;</span> <span class="n">min_level</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check milestone-specific conditions</span>
        <span class="n">thresholds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_thresholds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">milestone</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">milestone</span> <span class="o">==</span> <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">FIRST_BRAVE_ACT</span><span class="p">:</span>
            <span class="c1"># Check if this event involved courage</span>
            <span class="k">if</span> <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">:</span>
                <span class="n">courage_change</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COURAGE</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">courage_change</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># Significant courage development</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">milestone</span> <span class="o">==</span> <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">WISE_DECISION_MAKER</span><span class="p">:</span>
            <span class="c1"># Check for wisdom development and decision-making context</span>
            <span class="k">if</span> <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">:</span>
                <span class="n">wisdom_change</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">WISDOM</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">wisdom_change</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="s2">&quot;decision&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">story_context</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">milestone</span> <span class="o">==</span> <span class="n">CharacterMilestone</span><span class="o">.</span><span class="n">COMPASSIONATE_HELPER</span><span class="p">:</span>
            <span class="c1"># Check for compassion development and helping context</span>
            <span class="k">if</span> <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">:</span>
                <span class="n">compassion_change</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">[</span>
                    <span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">COMPASSION</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">compassion_change</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="s2">&quot;help&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">story_context</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="ow">or</span> <span class="s2">&quot;support&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">story_context</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_achieve_milestone</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">milestone</span><span class="p">:</span> <span class="n">CharacterMilestone</span><span class="p">,</span>
        <span class="n">template</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">triggering_event</span><span class="p">:</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process milestone achievement.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create milestone achievement record</span>
            <span class="n">achievement</span> <span class="o">=</span> <span class="n">CharacterMilestoneAchievement</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                <span class="n">milestone</span><span class="o">=</span><span class="n">milestone</span><span class="p">,</span>
                <span class="n">trigger</span><span class="o">=</span><span class="n">triggering_event</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
                <span class="n">triggering_choice</span><span class="o">=</span><span class="n">triggering_event</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="n">story_context</span><span class="o">=</span><span class="n">triggering_event</span><span class="o">.</span><span class="n">story_context</span><span class="p">,</span>
                <span class="n">attribute_levels_at_achievement</span><span class="o">=</span><span class="p">{</span>
                    <span class="n">attr</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">current_level</span>
                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="n">celebration_story</span><span class="o">=</span><span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;celebration_story&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">character_recognition</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Achievement unlocked: </span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">milestone</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">attribute_bonuses</span><span class="o">=</span><span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attribute_bonuses&quot;</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="n">story_unlocks</span><span class="o">=</span><span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;story_unlocks&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">)</span>

            <span class="c1"># Apply attribute bonuses</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">bonus</span> <span class="ow">in</span> <span class="n">achievement</span><span class="o">.</span><span class="n">attribute_bonuses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_attribute_change</span><span class="p">(</span>
                    <span class="n">user_id</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">bonus</span><span class="p">,</span> <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">MILESTONE_ACHIEVEMENT</span>
                <span class="p">)</span>

            <span class="c1"># Store achievement</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">achievement</span><span class="p">)</span>

            <span class="c1"># Update session context</span>
            <span class="n">session_state</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;recent_milestone_achievement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;milestone&quot;</span><span class="p">:</span> <span class="n">milestone</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">milestone</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                <span class="s2">&quot;celebration_story&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">celebration_story</span><span class="p">,</span>
                <span class="s2">&quot;attribute_bonuses&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">bonus</span>
                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">bonus</span> <span class="ow">in</span> <span class="n">achievement</span><span class="o">.</span><span class="n">attribute_bonuses</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;story_unlocks&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">story_unlocks</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Publish milestone achievement event</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_milestone_event</span><span class="p">(</span><span class="n">session_state</span><span class="p">,</span> <span class="n">achievement</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;milestones_achieved&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;character_celebrations&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to achieve milestone </span><span class="si">{</span><span class="n">milestone</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_ability_unlocks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">event</span><span class="p">:</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for ability unlocks based on character development.&quot;&quot;&quot;</span>
        <span class="n">user_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">user_milestones</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">:</span>
            <span class="n">user_milestones</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">achievement</span><span class="o">.</span><span class="n">milestone</span>
                <span class="k">for</span> <span class="n">achievement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Get existing abilities</span>
        <span class="n">existing_abilities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="p">:</span>
            <span class="n">existing_abilities</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">ability</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ability</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Check each ability type</span>
        <span class="k">for</span> <span class="n">ability_type</span><span class="p">,</span> <span class="n">abilities</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ability_templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">ability_template</span> <span class="ow">in</span> <span class="n">abilities</span><span class="p">:</span>
                <span class="n">ability_name</span> <span class="o">=</span> <span class="n">ability_template</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">ability_name</span> <span class="ow">in</span> <span class="n">existing_abilities</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Already unlocked</span>

                <span class="c1"># Check unlock conditions</span>
                <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ability_unlock_conditions</span><span class="p">(</span>
                    <span class="n">ability_template</span><span class="p">,</span> <span class="n">user_attributes</span><span class="p">,</span> <span class="n">user_milestones</span><span class="p">,</span> <span class="n">event</span>
                <span class="p">):</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unlock_ability</span><span class="p">(</span>
                        <span class="n">user_id</span><span class="p">,</span> <span class="n">session_state</span><span class="p">,</span> <span class="n">ability_type</span><span class="p">,</span> <span class="n">ability_template</span>
                    <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_ability_unlock_conditions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ability_template</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">user_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">CharacterAttribute</span><span class="p">,</span> <span class="n">CharacterAttributeLevel</span><span class="p">],</span>
        <span class="n">user_milestones</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">CharacterMilestone</span><span class="p">],</span>
        <span class="n">event</span><span class="p">:</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if ability unlock conditions are satisfied.&quot;&quot;&quot;</span>
        <span class="c1"># Check required attributes</span>
        <span class="n">required_attributes</span> <span class="o">=</span> <span class="n">ability_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required_attributes&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">min_level</span> <span class="ow">in</span> <span class="n">required_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_attributes</span>
                <span class="ow">or</span> <span class="n">user_attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">current_level</span> <span class="o">&lt;</span> <span class="n">min_level</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check required milestones (if any)</span>
        <span class="n">required_milestones</span> <span class="o">=</span> <span class="n">ability_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required_milestones&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">milestone</span> <span class="ow">in</span> <span class="n">required_milestones</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">milestone</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_milestones</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check story conditions (simplified for now)</span>
        <span class="n">story_conditions</span> <span class="o">=</span> <span class="n">ability_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;story_conditions&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">story_conditions</span><span class="p">:</span>
            <span class="c1"># Check if any story condition is met in the current event</span>
            <span class="n">event_context</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">story_context</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">condition</span> <span class="ow">in</span> <span class="n">event_context</span> <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">story_conditions</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># All conditions met</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_unlock_ability</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">ability_type</span><span class="p">:</span> <span class="n">AbilityType</span><span class="p">,</span>
        <span class="n">ability_template</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unlock a new ability for the character.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create ability</span>
            <span class="n">ability</span> <span class="o">=</span> <span class="n">CharacterAbility</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">ability_template</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">ability_template</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                <span class="n">ability_type</span><span class="o">=</span><span class="n">ability_type</span><span class="p">,</span>
                <span class="n">required_attributes</span><span class="o">=</span><span class="n">ability_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required_attributes&quot;</span><span class="p">,</span> <span class="p">{}),</span>
                <span class="n">unlock_trigger</span><span class="o">=</span><span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">MILESTONE_ACHIEVEMENT</span><span class="p">,</span>
                <span class="n">unlock_story</span><span class="o">=</span><span class="n">ability_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unlock_story&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">usage_examples</span><span class="o">=</span><span class="n">ability_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_examples&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">)</span>

            <span class="c1"># Store ability</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ability</span><span class="p">)</span>

            <span class="c1"># Update session context</span>
            <span class="n">session_state</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;recent_ability_unlock&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ability_name&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;ability_description&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="s2">&quot;ability_type&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">ability_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;unlock_story&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">unlock_story</span><span class="p">,</span>
                <span class="s2">&quot;usage_examples&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">usage_examples</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Publish ability unlock event</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_ability_unlock_event</span><span class="p">(</span><span class="n">session_state</span><span class="p">,</span> <span class="n">ability</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;abilities_unlocked&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to unlock ability </span><span class="si">{</span><span class="n">ability_template</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_publish_development_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">CharacterDevelopmentEvent</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish character development event.&quot;&quot;&quot;</span>
        <span class="n">narrative_event</span> <span class="o">=</span> <span class="n">NarrativeEvent</span><span class="p">(</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">EventType</span><span class="o">.</span><span class="n">CHARACTER_DEVELOPED</span><span class="p">,</span>
            <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">event_id</span><span class="p">,</span>
                <span class="s2">&quot;development_trigger&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;attribute_changes&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">change</span>
                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;experience_gained&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">xp</span> <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">xp</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">experience_gained</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;character_feedback&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">character_feedback</span><span class="p">,</span>
                <span class="s2">&quot;narrative_impact&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">narrative_impact</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">narrative_event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_publish_milestone_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span> <span class="n">achievement</span><span class="p">:</span> <span class="n">CharacterMilestoneAchievement</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish milestone achievement event.&quot;&quot;&quot;</span>
        <span class="n">narrative_event</span> <span class="o">=</span> <span class="n">NarrativeEvent</span><span class="p">(</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">EventType</span><span class="o">.</span><span class="n">CHARACTER_MILESTONE_ACHIEVED</span><span class="p">,</span>
            <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;achievement_id&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">achievement_id</span><span class="p">,</span>
                <span class="s2">&quot;milestone&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">milestone</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;celebration_story&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">celebration_story</span><span class="p">,</span>
                <span class="s2">&quot;character_recognition&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">character_recognition</span><span class="p">,</span>
                <span class="s2">&quot;attribute_bonuses&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">bonus</span>
                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">bonus</span> <span class="ow">in</span> <span class="n">achievement</span><span class="o">.</span><span class="n">attribute_bonuses</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;story_unlocks&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">story_unlocks</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">narrative_event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_publish_ability_unlock_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span> <span class="n">ability</span><span class="p">:</span> <span class="n">CharacterAbility</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Publish ability unlock event.&quot;&quot;&quot;</span>
        <span class="n">narrative_event</span> <span class="o">=</span> <span class="n">NarrativeEvent</span><span class="p">(</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">EventType</span><span class="o">.</span><span class="n">CHARACTER_ABILITY_UNLOCKED</span><span class="p">,</span>
            <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;ability_id&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">ability_id</span><span class="p">,</span>
                <span class="s2">&quot;ability_name&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;ability_description&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="s2">&quot;ability_type&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">ability_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;unlock_story&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">unlock_story</span><span class="p">,</span>
                <span class="s2">&quot;usage_examples&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">usage_examples</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">narrative_event</span><span class="p">)</span>

<div class="viewcode-block" id="CharacterDevelopmentSystem.get_character_summary">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem.get_character_summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_character_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive character development summary for a user.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No character data available&quot;</span><span class="p">}</span>

        <span class="n">user_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">user_abilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">user_milestones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Calculate overall character level (average of all attributes)</span>
        <span class="n">total_level</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">current_level</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">user_attributes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">average_level</span> <span class="o">=</span> <span class="n">total_level</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">)</span>

        <span class="c1"># Get top attributes</span>
        <span class="n">top_attributes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">user_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">current_level</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>

        <span class="c1"># Get recent development</span>
        <span class="n">recent_events</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">:</span>
            <span class="n">recent_events</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">[</span><span class="n">user_id</span><span class="p">],</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">occurred_at</span><span class="p">,</span>
                <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s2">&quot;overall_level&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">average_level</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;total_experience&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">experience_points</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">user_attributes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;current_level&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">current_level</span><span class="p">,</span>
                    <span class="s2">&quot;experience_points&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">experience_points</span><span class="p">,</span>
                    <span class="s2">&quot;level_progress&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">level_progress</span><span class="p">,</span>
                    <span class="s2">&quot;peak_level&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">peak_level</span><span class="p">,</span>
                    <span class="s2">&quot;development_rate&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">development_rate</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attr_level</span> <span class="ow">in</span> <span class="n">user_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s2">&quot;top_attributes&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">value</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attr_level</span> <span class="ow">in</span> <span class="n">top_attributes</span>
            <span class="p">],</span>
            <span class="s2">&quot;abilities&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">ability_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;usage_count&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">usage_count</span><span class="p">,</span>
                    <span class="s2">&quot;effectiveness&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">effectiveness_rating</span><span class="p">,</span>
                    <span class="s2">&quot;unlocked_at&quot;</span><span class="p">:</span> <span class="n">ability</span><span class="o">.</span><span class="n">unlocked_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">ability</span> <span class="ow">in</span> <span class="n">user_abilities</span>
            <span class="p">],</span>
            <span class="s2">&quot;milestones&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;milestone&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">milestone</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">achievement</span><span class="o">.</span><span class="n">milestone</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">achievement</span><span class="o">.</span><span class="n">milestone</span><span class="o">.</span><span class="n">value</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;achieved_at&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">achieved_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                    <span class="s2">&quot;celebration_story&quot;</span><span class="p">:</span> <span class="n">achievement</span><span class="o">.</span><span class="n">celebration_story</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">achievement</span> <span class="ow">in</span> <span class="n">user_milestones</span>
            <span class="p">],</span>
            <span class="s2">&quot;recent_development&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;attribute_changes&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">change</span>
                        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;occurred_at&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">occurred_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">recent_events</span>
            <span class="p">],</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="CharacterDevelopmentSystem.get_character_progression_visualization">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem.get_character_progression_visualization">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_character_progression_visualization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get character progression data for visualization.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No character data available&quot;</span><span class="p">}</span>

        <span class="n">user_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>

        <span class="c1"># Prepare attribute progression data</span>
        <span class="n">attribute_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">attr_level</span> <span class="ow">in</span> <span class="n">user_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">{})</span>

            <span class="n">attribute_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="s2">&quot;current_level&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span><span class="p">,</span>
                    <span class="s2">&quot;level_progress&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">level_progress</span><span class="p">,</span>
                    <span class="s2">&quot;experience_points&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">experience_points</span><span class="p">,</span>
                    <span class="s2">&quot;peak_level&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">peak_level</span><span class="p">,</span>
                    <span class="s2">&quot;development_rate&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">development_rate</span><span class="p">,</span>
                    <span class="s2">&quot;story_manifestations&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">story_manifestations</span><span class="p">[</span>
                        <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                    <span class="p">],</span>  <span class="c1"># Last 3</span>
                    <span class="s2">&quot;character_reactions&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">character_reactions</span><span class="p">[</span>
                        <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                    <span class="p">],</span>  <span class="c1"># Last 3</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># Calculate next level requirements</span>
        <span class="n">next_level_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">attr_level</span> <span class="ow">in</span> <span class="n">user_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">current_level_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attr_level</span><span class="o">.</span><span class="n">current_level</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_level_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">next_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span><span class="p">[</span><span class="n">current_level_index</span><span class="p">]</span>
                <span class="n">xp_needed</span> <span class="o">=</span> <span class="n">next_threshold</span> <span class="o">-</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">experience_points</span>

                <span class="n">next_level_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="s2">&quot;current_xp&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">experience_points</span><span class="p">,</span>
                        <span class="s2">&quot;next_level_xp&quot;</span><span class="p">:</span> <span class="n">next_threshold</span><span class="p">,</span>
                        <span class="s2">&quot;xp_needed&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xp_needed</span><span class="p">),</span>
                        <span class="s2">&quot;progress_percentage&quot;</span><span class="p">:</span> <span class="n">attr_level</span><span class="o">.</span><span class="n">level_progress</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s2">&quot;attribute_progression&quot;</span><span class="p">:</span> <span class="n">attribute_data</span><span class="p">,</span>
            <span class="s2">&quot;next_level_requirements&quot;</span><span class="p">:</span> <span class="n">next_level_data</span><span class="p">,</span>
            <span class="s2">&quot;total_milestones&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="s2">&quot;total_abilities&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="s2">&quot;development_events_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">[])),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="CharacterDevelopmentSystem.handle_character_regression">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem.handle_character_regression">[docs]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_character_regression</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">session_state</span><span class="p">:</span> <span class="n">SessionState</span><span class="p">,</span>
        <span class="n">regression_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle temporary character regression as learning opportunity.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create regression event</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHALLENGE_OVERCOME</span><span class="p">,</span>  <span class="c1"># Regression is a challenge to overcome</span>
                <span class="n">description</span><span class="o">=</span><span class="n">regression_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;Character faces a temporary setback&quot;</span>
                <span class="p">),</span>
                <span class="n">story_context</span><span class="o">=</span><span class="n">regression_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;story_context&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Apply temporary regression</span>
            <span class="n">regression_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_rules</span><span class="p">[</span><span class="s2">&quot;regression_rules&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">regression_rules</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
                <span class="n">affected_attributes</span> <span class="o">=</span> <span class="n">regression_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;affected_attributes&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">CharacterAttribute</span><span class="o">.</span><span class="n">RESILIENCE</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">max_regression</span> <span class="o">=</span> <span class="n">regression_rules</span><span class="p">[</span><span class="s2">&quot;max_regression&quot;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">affected_attributes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span>
                        <span class="ow">and</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="c1"># Apply small regression</span>
                        <span class="n">regression_amount</span> <span class="o">=</span> <span class="o">-</span><span class="nb">min</span><span class="p">(</span>
                            <span class="n">max_regression</span><span class="p">,</span> <span class="mf">0.2</span>
                        <span class="p">)</span>  <span class="c1"># Small regression</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_attribute_change</span><span class="p">(</span>
                            <span class="n">user_id</span><span class="p">,</span>
                            <span class="n">attribute</span><span class="p">,</span>
                            <span class="n">regression_amount</span><span class="p">,</span>
                            <span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHALLENGE_OVERCOME</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">attribute_changes</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">regression_amount</span>

                <span class="c1"># Generate story explanation</span>
                <span class="n">event</span><span class="o">.</span><span class="n">character_feedback</span> <span class="o">=</span> <span class="n">regression_rules</span><span class="p">[</span><span class="s2">&quot;story_explanation&quot;</span><span class="p">]</span>
                <span class="n">event</span><span class="o">.</span><span class="n">narrative_impact</span> <span class="o">=</span> <span class="s2">&quot;This setback is temporary - an opportunity to demonstrate resilience and growth.&quot;</span>

            <span class="c1"># Store event</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="c1"># Update session context</span>
            <span class="n">session_state</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;character_regression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">event_id</span><span class="p">,</span>
                <span class="s2">&quot;is_temporary&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;recovery_opportunity&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;story_explanation&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">character_feedback</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">event</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to handle character regression for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">CharacterDevelopmentEvent</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">session_id</span><span class="o">=</span><span class="n">session_state</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">DevelopmentTrigger</span><span class="o">.</span><span class="n">CHALLENGE_OVERCOME</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Character regression event&quot;</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="CharacterDevelopmentSystem.get_metrics">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem.get_metrics">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get character development system metrics.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
            <span class="s2">&quot;total_characters_tracked&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">character_attributes</span><span class="p">),</span>
            <span class="s2">&quot;total_abilities_unlocked&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">abilities</span><span class="p">)</span> <span class="k">for</span> <span class="n">abilities</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">character_abilities</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="s2">&quot;total_milestones_achieved&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">achievements</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">achievements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">milestone_achievements</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="s2">&quot;total_development_events&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">development_events</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="s2">&quot;attribute_templates_loaded&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="p">),</span>
            <span class="s2">&quot;ability_templates_loaded&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">abilities</span><span class="p">)</span> <span class="k">for</span> <span class="n">abilities</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ability_templates</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="s2">&quot;milestone_templates_loaded&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milestone_templates</span><span class="p">),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="CharacterDevelopmentSystem.health_check">
<a class="viewcode-back" href="../../../../../api/src.components.gameplay_loop.narrative.character_development_system.html#src.components.gameplay_loop.narrative.character_development_system.CharacterDevelopmentSystem.health_check">[docs]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform health check of character development system.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;attribute_templates_loaded&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attribute_templates</span><span class="p">),</span>
            <span class="s2">&quot;ability_templates_loaded&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">abilities</span><span class="p">)</span> <span class="k">for</span> <span class="n">abilities</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ability_templates</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="s2">&quot;milestone_templates_loaded&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milestone_templates</span><span class="p">),</span>
            <span class="s2">&quot;development_rules_configured&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">development_rules</span><span class="p">),</span>
            <span class="s2">&quot;level_thresholds_configured&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_thresholds</span><span class="p">),</span>
            <span class="s2">&quot;milestone_thresholds_configured&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milestone_thresholds</span><span class="p">),</span>
            <span class="s2">&quot;ability_unlock_conditions_configured&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ability_unlock_conditions</span><span class="p">),</span>
            <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(),</span>
        <span class="p">}</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, TTA Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
