# TTA Therapeutic Gaming Redis Configuration
# Optimized for session management, caching, and real-time data

# ============================================================================
# NETWORK AND SECURITY
# ============================================================================

# Bind to all interfaces (Docker networking)
bind 0.0.0.0

# Default port
port 6379

# Require authentication
requirepass TTA_Redis_2024!

# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG "TTA_CONFIG_CMD"

# ============================================================================
# MEMORY MANAGEMENT
# ============================================================================

# Maximum memory usage (1GB)
maxmemory 1gb

# Memory eviction policy - remove least recently used keys
maxmemory-policy allkeys-lru

# Memory sampling for LRU
maxmemory-samples 5

# ============================================================================
# PERSISTENCE CONFIGURATION
# ============================================================================

# RDB Snapshots
# Save snapshot if at least 1 key changed in 900 seconds (15 minutes)
save 900 1
# Save snapshot if at least 10 keys changed in 300 seconds (5 minutes)
save 300 10
# Save snapshot if at least 10000 keys changed in 60 seconds
save 60 10000

# RDB file name
dbfilename tta-therapeutic-gaming.rdb

# Directory for RDB and AOF files
dir /data

# RDB compression
rdbcompression yes

# RDB checksum
rdbchecksum yes

# ============================================================================
# APPEND ONLY FILE (AOF) CONFIGURATION
# ============================================================================

# Enable AOF persistence
appendonly yes

# AOF filename
appendfilename "tta-therapeutic-gaming.aof"

# AOF sync policy - sync every second (good balance of performance and durability)
appendfsync everysec

# Disable AOF rewrite during RDB save
no-appendfsync-on-rewrite no

# AOF rewrite configuration
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Load truncated AOF file on startup
aof-load-truncated yes

# Use RDB-AOF hybrid persistence
aof-use-rdb-preamble yes

# ============================================================================
# CLIENT CONFIGURATION
# ============================================================================

# Maximum number of connected clients
maxclients 10000

# Client timeout (0 = no timeout)
timeout 0

# TCP keepalive
tcp-keepalive 300

# TCP listen backlog
tcp-backlog 511

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# Number of databases
databases 16

# Database 0: Session data and user authentication
# Database 1: Character and world caching
# Database 2: Real-time chat and WebSocket data
# Database 3: Progress tracking and analytics
# Database 4: Therapeutic metrics and outcomes
# Database 5: System health and monitoring
# Database 6-15: Reserved for future use

# ============================================================================
# LOGGING
# ============================================================================

# Log level (debug, verbose, notice, warning)
loglevel notice

# Log file (empty string = log to stdout)
logfile ""

# Enable syslog
syslog-enabled no

# ============================================================================
# SLOW LOG CONFIGURATION
# ============================================================================

# Log queries slower than 10 milliseconds
slowlog-log-slower-than 10000

# Keep last 128 slow queries
slowlog-max-len 128

# ============================================================================
# LATENCY MONITORING
# ============================================================================

# Enable latency monitoring
latency-monitor-threshold 100

# ============================================================================
# KEY EXPIRATION AND NOTIFICATIONS
# ============================================================================

# Notify clients about key events
notify-keyspace-events "Ex"

# ============================================================================
# THERAPEUTIC GAMING SPECIFIC SETTINGS
# ============================================================================

# Custom settings for TTA system

# Session timeout (24 hours in seconds)
# Used for automatic session cleanup
# SET session:timeout 86400

# Chat message retention (7 days in seconds)
# Used for chat history cleanup
# SET chat:retention 604800

# Progress update frequency (5 minutes in seconds)
# Used for progress tracking intervals
# SET progress:update_interval 300

# Therapeutic metrics aggregation interval (1 hour in seconds)
# Used for analytics and reporting
# SET metrics:aggregation_interval 3600

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Hash table resize policy
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List compression
list-max-ziplist-size -2
list-compress-depth 0

# Set optimization
set-max-intset-entries 512

# Sorted set optimization
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog sparse representation
hll-sparse-max-bytes 3000

# Stream configuration
stream-node-max-bytes 4096
stream-node-max-entries 100

# ============================================================================
# REPLICATION (for future scaling)
# ============================================================================

# Replica settings (currently disabled for single-instance setup)
# replica-serve-stale-data yes
# replica-read-only yes
# repl-diskless-sync no
# repl-diskless-sync-delay 5

# ============================================================================
# CLUSTER (for future scaling)
# ============================================================================

# Cluster settings (currently disabled for single-instance setup)
# cluster-enabled no
# cluster-config-file nodes-6379.conf
# cluster-node-timeout 15000

# ============================================================================
# MODULES (for future extensions)
# ============================================================================

# Redis modules can be loaded here for additional functionality
# loadmodule /path/to/module.so

# ============================================================================
# THERAPEUTIC GAMING KEY PATTERNS
# ============================================================================

# Key naming conventions for TTA system:
#
# Sessions:
# - session:{session_id}:data
# - session:{session_id}:progress
# - session:{session_id}:chat_history
#
# Users:
# - user:{user_id}:profile
# - user:{user_id}:preferences
# - user:{user_id}:active_sessions
#
# Characters:
# - character:{character_id}:data
# - character:{character_id}:progress
# - character:{character_id}:achievements
#
# Worlds:
# - world:{world_id}:config
# - world:{world_id}:active_sessions
# - world:{world_id}:metrics
#
# Real-time:
# - chat:{session_id}:messages
# - websocket:{connection_id}:data
# - presence:{user_id}:status
#
# Analytics:
# - metrics:daily:{date}
# - metrics:user:{user_id}:{date}
# - metrics:world:{world_id}:{date}
#
# System:
# - health:services
# - health:connections
# - config:system
